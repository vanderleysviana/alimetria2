<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Montador de Dietas - Sistema Nutricional</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --azul-escuro:#1A73E8;
      --azul-medio:#4F8FF7;
      --azul-claro:#DCEBFF;
      --branco:#FFFFFF;
      --texto:#2b2b2b;
      --card-radius:12px;
      --card-padding:20px;
      --gap:24px;
    }
    html,body,#app{height:100%;margin:0;font-family:Inter,Roboto,system-ui,Segoe UI,Arial;background:linear-gradient(180deg,var(--branco),#f7fbff);}
    .container{max-width:980px;margin:16px auto;padding:16px;box-sizing:border-box;}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap;gap:12px;}
    h1{font-size:18px;color:var(--azul-escuro);margin:0}
    .patient{display:flex;gap:12px;align-items:center;flex-wrap:wrap;}
    select,button,input{font-family:inherit}
    .layout{display:flex;flex-direction:column;gap:var(--gap)}
    .meal-card{background:var(--azul-claro);border-radius:var(--card-radius);padding:var(--card-padding);box-shadow:0 6px 14px rgba(26,115,232,0.08);}
    .meal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;flex-wrap:wrap;gap:8px;}
    .btn{background:var(--azul-medio);color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-size:14px;transition:background 0.2s;}
    .btn:hover{background:var(--azul-escuro)}
    .btn:disabled{background:#94a3b8;cursor:not-allowed;}
    .food-list{display:flex;flex-direction:column;gap:8px}
    .food-item{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,0.6);padding:8px;border-radius:8px;flex-wrap:wrap;gap:8px;}
    .totals{margin-top:12px;background:rgba(255,255,255,0.5);padding:10px;border-radius:8px;display:flex;gap:12px;flex-wrap:wrap}
    .summary{position:static;bottom:16px;margin-top:20px;padding:16px;border-radius:12px;background:linear-gradient(90deg,var(--azul-claro),#f0f7ff);box-shadow:0 8px 30px rgba(26,115,232,0.06)}
    .alerts{margin-top:12px;display:flex;flex-direction:column;gap:8px}
    .alert{border-left:4px solid var(--azul-escuro);background:#fff;padding:10px;border-radius:8px;color:var(--texto)}
    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(10,30,80,0.35);display:flex;align-items:center;justify-content:center;z-index:40}
    .modal{background:var(--branco);padding:18px;border-radius:12px;width:92%;max-width:640px;border:1px solid rgba(79,143,247,0.18);max-height:90vh;overflow-y:auto;}
    .modal h3{color:var(--azul-escuro);margin:0 0 8px 0}
    .field{display:flex;flex-direction:column;margin-bottom:8px}
    .field label{font-size:13px;color:#334155;margin-bottom:4px}
    .field input, .field textarea{padding:8px;border-radius:8px;border:1px solid #dbeafe}
    table{width:100%;border-collapse:collapse;margin-top:8px;font-size:13px}
    th,td{padding:8px;text-align:left;border-bottom:1px solid rgba(0,0,0,0.04)}
    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
    @media(min-width:900px){ .container{padding:24px} }
    #saveDietFloating{
      position:fixed;
      right:18px;
      bottom:18px;
      z-index:60;
      border-radius:12px;
      padding:12px 16px;
      background:#10b981;
      color:white;
      box-shadow:0 8px 20px rgba(16,185,129,0.18);
      display:none;
      border:none;
      cursor:pointer;
      font-size:14px;
    }
    
    /* Status messages */
    .status-message{padding:16px;border-radius:8px;margin:16px 0;text-align:center;}
    .status-success{background:#d1fae5;color:#065f46;border:1px solid #a7f3d0;}
    .status-error{background:#fee2e2;color:#991b1b;border:1px solid #fecaca;}
    .status-info{background:#dbeafe;color:#1e40af;border:1px solid #93c5fd;}
    
    /* Patient display */
    #patientDisplay{min-height:44px;display:flex;align-items:center;}

    /* Estilos adicionais para o sistema atualizado */
    .patient-row {
      transition: all 0.3s ease;
    }

    .patient-row:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .tab-btn {
      background: none;
      border: none;
      padding: 12px 20px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      color: #6b7280;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .tab-btn:hover {
      color: #374151;
      background: #f9fafb;
    }

    .tab-btn.active {
      color: #8B5CF6;
      border-bottom-color: #8B5CF6;
      background: #f8fafc;
    }

    .status-success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #a7f3d0;
      padding: 12px 16px;
      border-radius: 8px;
      margin: 16px 0;
    }

    .status-error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #fecaca;
      padding: 12px 16px;
      border-radius: 8px;
      margin: 16px 0;
    }

    .status-info {
      background: #dbeafe;
      color: #1e40af;
      border: 1px solid #93c5fd;
      padding: 12px 16px;
      border-radius: 8px;
      margin: 16px 0;
    }

    /* Melhorias de responsividade */
    @media (max-width: 768px) {
      .patient-row {
        flex-direction: column;
        gap: 16px;
      }
      
      .patient-row .actions {
        width: 100%;
      }
      
      .tab-btn {
        padding: 10px 16px;
        font-size: 14px;
      }
    }

    /* Anima√ß√µes suaves */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .modal {
      animation: fadeIn 0.3s ease;
    }

    .meal-card {
      animation: fadeIn 0.4s ease;
    }
  </style>

  <!-- No seu index.html, atualize o importmap -->
<script type="importmap">
{
  "imports": {
    "nanoid": "https://esm.sh/nanoid@4.0.2",
    "jspdf": "https://esm.sh/jspdf@2.5.1",
    "chart.js": "https://esm.sh/chart.js@4.4.0",
    "chart.js/auto": "https://esm.sh/chart.js@4.4.0/auto",
    "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@2"
  }
}
</script>
</head>
<body>
  <div id="app" class="container">
    <header>
      <h1>üçΩÔ∏è Montador de Dietas</h1>
      <div class="patient">
        <div style="min-width:200px;">
          <label style="font-size:12px;color:#475569">Paciente Atual</label>
          <div id="patientDisplay" style="padding:8px 12px;border-radius:8px;border:1px solid #e2e8f0;background:#fff;color:#0f172a;min-height:40px;display:flex;align-items:center;">
            ‚Äî nenhum paciente selecionado ‚Äî
          </div>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <button id="managePatientsBtn" class="btn" style="background:#10b981;">üë• Gerenciar Pacientes</button>
          <button id="exportPdfBtn" class="btn">üìÑ Exportar PDF</button>
        </div>
      </div>
    </header>

    <main>
      <!-- Status Message -->
      <div id="statusMessage" style="display:none;"></div>

      <!-- Main Content -->
      <div class="layout" id="mealsContainer">
        <!-- meals injected here -->
        <div id="welcomeMessage" style="text-align:center;padding:40px 20px;color:#64748b;">
          <div style="font-size:48px;margin-bottom:16px;">üçé</div>
          <h2 style="color:#1e40af;margin-bottom:16px;">Bem-vindo ao Montador de Dietas</h2>
          <p style="margin-bottom:24px;line-height:1.6;">Clique em "Gerenciar Pacientes" para come√ßar a criar dietas personalizadas.</p>
          <button id="quickStartBtn" class="btn" style="background:#1e40af;padding:12px 24px;">
            üöÄ Come√ßar Agora
          </button>
        </div>
      </div>

      <div class="summary" id="summaryPanel" style="margin-top:18px;display:none;">
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;">
          <div>
            <strong style="font-size:16px;color:var(--azul-escuro)">üìä Resumo Nutricional do Dia</strong>
            <div style="font-size:13px;color:#334155">Totais agregados de todas as refei√ß√µes</div>
          </div>
          <div class="controls">
            <button id="clearBtn" class="btn" style="background:#ef4444;">üóëÔ∏è Limpar Tudo</button>
          </div>
        </div>
        <div id="summaryDetails" style="margin-top:12px;display:flex;gap:12px;flex-wrap:wrap"></div>
        <div id="alerts" class="alerts"></div>
      </div>
    </main>
  </div>

  <!-- Modal template -->
  <div id="modalRoot"></div>

  <!-- Floating Save Button -->
  <button id="saveDietFloating">üíæ Salvar Dieta</button>

  <!-- Script principal -->
  <script type="module">
    // Importa√ß√£o dos m√≥dulos principais
    import './src/supabase.js';
    import './src/state.js';
    import './src/tacoLoader.js';
    import './src/ui.js';
    import './src/modals.js';
    import './src/pdf.js';
    import './src/patientManager.js';
    import './src/patientDiets.js';
    import './src/consultations.js';
    import './src/patients.js';
    import './src/app.js';
  </script>
</body>
</html>
