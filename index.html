<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sistema Nutricional - Montador de Dietas</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --azul-escuro:#1A73E8;
      --azul-medio:#4F8FF7;
      --azul-claro:#DCEBFF;
      --branco:#FFFFFF;
      --texto:#2b2b2b;
      --card-radius:12px;
      --card-padding:20px;
      --gap:24px;
    }
    html,body,#app{height:100%;margin:0;font-family:Inter,Roboto,system-ui,Segoe UI,Arial;background:linear-gradient(180deg,var(--branco),#f7fbff);}
    .container{max-width:980px;margin:16px auto;padding:16px;box-sizing:border-box;}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap;gap:12px;}
    h1{font-size:18px;color:var(--azul-escuro);margin:0}
    .patient{display:flex;gap:12px;align-items:center;flex-wrap:wrap;}
    select,button,input{font-family:inherit}
    .layout{display:flex;flex-direction:column;gap:var(--gap)}
    .meal-card{background:var(--azul-claro);border-radius:var(--card-radius);padding:var(--card-padding);box-shadow:0 6px 14px rgba(26,115,232,0.08);}
    .meal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;flex-wrap:wrap;gap:8px;}
    .btn{background:var(--azul-medio);color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-size:14px;transition:background 0.2s;}
    .btn:hover{background:var(--azul-escuro)}
    .btn:disabled{background:#94a3b8;cursor:not-allowed;}
    .food-list{display:flex;flex-direction:column;gap:8px}
    .food-item{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,0.6);padding:8px;border-radius:8px;flex-wrap:wrap;gap:8px;}
    .totals{margin-top:12px;background:rgba(255,255,255,0.5);padding:10px;border-radius:8px;display:flex;gap:12px;flex-wrap:wrap}
    .summary{position:static;bottom:16px;margin-top:20px;padding:16px;border-radius:12px;background:linear-gradient(90deg,var(--azul-claro),#f0f7ff);box-shadow:0 8px 30px rgba(26,115,232,0.06)}
    .alerts{margin-top:12px;display:flex;flex-direction:column;gap:8px}
    .alert{border-left:4px solid var(--azul-escuro);background:#fff;padding:10px;border-radius:8px;color:var(--texto)}
    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(10,30,80,0.35);display:flex;align-items:center;justify-content:center;z-index:40}
    .modal{background:var(--branco);padding:18px;border-radius:12px;width:92%;max-width:640px;border:1px solid rgba(79,143,247,0.18);max-height:90vh;overflow-y:auto;}
    .modal h3{color:var(--azul-escuro);margin:0 0 8px 0}
    .field{display:flex;flex-direction:column;margin-bottom:8px}
    .field label{font-size:13px;color:#334155;margin-bottom:4px}
    .field input, .field textarea{padding:8px;border-radius:8px;border:1px solid #dbeafe}
    table{width:100%;border-collapse:collapse;margin-top:8px;font-size:13px}
    th,td{padding:8px;text-align:left;border-bottom:1px solid rgba(0,0,0,0.04)}
    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}
    @media(min-width:900px){ .container{padding:24px} }
    #saveDietFloating{
      position:fixed;
      right:18px;
      bottom:18px;
      z-index:60;
      border-radius:12px;
      padding:12px 16px;
      background:#10b981;
      color:white;
      box-shadow:0 8px 20px rgba(16,185,129,0.18);
      display:none;
      border:none;
      cursor:pointer;
      font-size:14px;
    }
    
    /* Status messages */
    .status-message{padding:16px;border-radius:8px;margin:16px 0;text-align:center;}
    .status-success{background:#d1fae5;color:#065f46;border:1px solid #a7f3d0;}
    .status-error{background:#fee2e2;color:#991b1b;border:1px solid #fecaca;}
    .status-info{background:#dbeafe;color:#1e40af;border:1px solid #93c5fd;}
    
    /* Patient display */
    #patientDisplay{min-height:44px;display:flex;align-items:center;}

    /* Estilos adicionais para o sistema atualizado */
    .patient-row {
      transition: all 0.3s ease;
    }

    .patient-row:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .tab-btn {
      background: none;
      border: none;
      padding: 12px 20px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      color: #6b7280;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .tab-btn:hover {
      color: #374151;
      background: #f9fafb;
    }

    .tab-btn.active {
      color: #8B5CF6;
      border-bottom-color: #8B5CF6;
      background: #f8fafc;
    }

    .status-success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #a7f3d0;
      padding: 12px 16px;
      border-radius: 8px;
      margin: 16px 0;
    }

    .status-error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #fecaca;
      padding: 12px 16px;
      border-radius: 8px;
      margin: 16px 0;
    }

    .status-info {
      background: #dbeafe;
      color: #1e40af;
      border: 1px solid #93c5fd;
      padding: 12px 16px;
      border-radius: 8px;
      margin: 16px 0;
    }

    /* Melhorias de responsividade */
    @media (max-width: 768px) {
      .patient-row {
        flex-direction: column;
        gap: 16px;
      }
      
      .patient-row .actions {
        width: 100%;
      }
      
      .tab-btn {
        padding: 10px 16px;
        font-size: 14px;
      }
      
      .container {
        padding: 12px;
      }
      
      header {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .patient {
        width: 100%;
        justify-content: space-between;
      }
    }

    /* Anima√ß√µes suaves */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .modal {
      animation: fadeIn 0.3s ease;
    }

    .meal-card {
      animation: fadeIn 0.4s ease;
    }

    /* Estilos para a tela de login */
    .auth-tab {
      transition: all 0.3s ease;
    }

    .auth-tab.active {
      font-weight: 600;
    }

    /* Loading states */
    .loading {
      opacity: 0.7;
      pointer-events: none;
    }

    .spinner {
      border: 2px solid #f3f3f3;
      border-top: 2px solid #3498db;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 8px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Melhorias de acessibilidade */
    @media (prefers-reduced-motion: reduce) {
      .patient-row,
      .modal,
      .meal-card,
      .auth-tab {
        transition: none;
        animation: none;
      }
    }

    /* Focus styles para acessibilidade */
    button:focus,
    input:focus,
    select:focus,
    textarea:focus {
      outline: 2px solid #3b82f6;
      outline-offset: 2px;
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      :root {
        --texto: #e5e7eb;
      }
      
      .meal-card {
        background: #1f2937;
      }
      
      .food-item {
        background: #374151;
      }
      
      .alert {
        background: #374151;
        color: #e5e7eb;
      }
    }
  </style>

  <script type="importmap">
  {
    "imports": {
      "nanoid": "https://esm.sh/nanoid@4.0.2",
      "jspdf": "https://esm.sh/jspdf@2.5.1",
      "chart.js": "https://esm.sh/chart.js@4.4.0",
      "chart.js/auto": "https://esm.sh/chart.js@4.4.0/auto",
      "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@2"
    }
  }
  </script>
</head>
<body>
  <!-- Aplica√ß√£o principal -->
  <div id="app">
    <!-- O conte√∫do ser√° injetado aqui pelo JavaScript -->
    <!-- Durante o carregamento mostrar um loading -->
    <div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
      <div style="text-align: center; color: white;">
        <div style="font-size: 4rem; margin-bottom: 1rem;">üçé</div>
        <h1 style="margin-bottom: 0.5rem;">Sistema Nutricional</h1>
        <p style="opacity: 0.8;">Carregando...</p>
        <div style="margin-top: 2rem;">
          <div class="spinner" style="border-top-color: white;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Script principal -->
  <script type="module">
    // Importa√ß√£o dos m√≥dulos principais
    import './src/supabase.js';
    import './src/auth.js';
    import './src/state.js';
    import './src/tacoLoader.js';
    import './src/ui.js';
    import './src/modals.js';
    import './src/pdf.js';
    import './src/patientManager.js';
    import './src/patientDiets.js';
    import './src/consultations.js';
    import './src/patients.js';
    import './src/app.js';

    // Remover loading screen quando a aplica√ß√£o carregar
    setTimeout(() => {
      const loadingScreen = document.querySelector('#app > div');
      if (loadingScreen && !document.querySelector('.container')) {
        loadingScreen.style.display = 'none';
      }
    }, 2000);
  </script>

  <!-- Analytics/Error Tracking (opcional) -->
  <script>
    // Error tracking b√°sico
    window.addEventListener('error', function(e) {
      console.error('Erro capturado:', e.error);
    });

    // Service Worker para PWA (futura implementa√ß√£o)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        // navigator.serviceWorker.register('/sw.js');
      });
    }
  </script>
</body>
</html>
